<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="keywords" content=""/>
  <meta name="description" content=""/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>MXD Desgin Week - Ranking</title>
  <link rel="shortcut icon" href="#"/>
  <link rel="stylesheet" href="../css/g.scss"/>
  <link rel="stylesheet" href="../css/index.scss"/>
  <script src="../js/jquery-3.1.0.min.js"></script>
</head>
<body>

<video class="bg-video" poster="../img/bg.png" autoplay loop>
  <source src="../img/bg.mp4" type="video/mp4">
</video>



<div class="container">
  <div class="left-cont">
    <div class="title-wrap">
      <span class="logo"></span>
      <p class="title-latest-score">最新成绩</p>
    </div>
    <div class="mbd-score-wrap">
      <ul class="mbd-score-list">
        <li class="mbd-score-item">
          <div class="mbd-score-avatar">
            <img src="http://wx.qlogo.cn/mmopen/ajNVdqHZLLDFVzZGAiatZQIickC2RKVBrgz141c8c8dkeNUmrsUHH7BDR4Qj1qPnibBl7TuTSaE9YWYnuYIwxSlULj2Yey9ajOCgIWfTaia0OcM/0" alt="Unicorn" class="mbd-avatar-img">
          </div><div class="mbd-score-resl">
            <b class="mbd-score-name">Unicorn</b>
            <span class="mbd-score-time">30分钟</span>
            <span class="mbd-score-gift">抱枕1个&nbsp;<b class="status">未认领</b></span>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <div class="right-cont">
    <div class="title-wrap">
      <p class="title-latest-onbaord">最新上榜</p>
    </div>

    <ul class="mbd-best-list">
      <!-- <li class="mbd-best-item">
        <span class="mbd-best-props gold"></span>
        <div class="mbd-best-avatar">
          <img src="http://wx.qlogo.cn/mmopen/ajNVdqHZLLDFVzZGAiatZQIickC2RKVBrgz141c8c8dkeNUmrsUHH7BDR4Qj1qPnibBl7TuTSaE9YWYnuYIwxSlULj2Yey9ajOCgIWfTaia0OcM/0" alt="Unicorn" class="mbd-avatar-img">
        </div><div class="mbd-best-resl">
          <p class="mbd-best-name">Kikizhu</p>
          <b class="mbd-best-time">26分钟</b>
        </div>
      </li>
      <li class="mbd-best-item">
        <span class="mbd-best-props silver"></span>
        <div class="mbd-best-avatar">
          <img src="http://wx.qlogo.cn/mmopen/ajNVdqHZLLDFVzZGAiatZQIickC2RKVBrgz141c8c8dkeNUmrsUHH7BDR4Qj1qPnibBl7TuTSaE9YWYnuYIwxSlULj2Yey9ajOCgIWfTaia0OcM/0" alt="Unicorn" class="mbd-avatar-img">
        </div><div class="mbd-best-resl">
          <p class="mbd-best-name">Kikizhu</p>
          <b class="mbd-best-time">26分钟</b>
        </div>
      </li>

      <li class="mbd-best-item">
        <span class="mbd-best-props copper"></span>
        <div class="mbd-best-avatar">
          <img src="http://wx.qlogo.cn/mmopen/ajNVdqHZLLDFVzZGAiatZQIickC2RKVBrgz141c8c8dkeNUmrsUHH7BDR4Qj1qPnibBl7TuTSaE9YWYnuYIwxSlULj2Yey9ajOCgIWfTaia0OcM/0" alt="Unicorn" class="mbd-avatar-img">
        </div><div class="mbd-best-resl">
          <p class="mbd-best-name">Kikizhu</p>
          <b class="mbd-best-time">26分钟</b>
        </div>
      </li> -->
      <li class="mbd-best-item">
        <span class="mbd-best-props air"></span>
        <div class="mbd-best-avatar">
          <img src="http://wx.qlogo.cn/mmopen/ajNVdqHZLLDFVzZGAiatZQIickC2RKVBrgz141c8c8dkeNUmrsUHH7BDR4Qj1qPnibBl7TuTSaE9YWYnuYIwxSlULj2Yey9ajOCgIWfTaia0OcM/0" alt="Unicorn" class="mbd-avatar-img">
        </div><div class="mbd-best-resl">
          <p class="mbd-best-name">Kikizhugdd</p>
          <b class="mbd-best-time">26分钟</b>
        </div>
      </li>
    </ul>
  </div>
</div>


<script>
$(function() {

  function AJAX(method, URL, async, type, callback, data) {
    var xml = new XMLHttpRequest();
    xml.responseType = type;
    xml.onreadystatechange = function() {
      if (xml.readyState == 4 && xml.status == 200) {
        var getRes = xml.response;
        callback(getRes);
      }
    };
    xml.onerror = function (e) {
      console.error(e);
    };
    xml.open(method, URL, async);
    xml.withCredentials = true;
    if (data) {
      xml.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      xml.send(data);
    } else {
      xml.send();
    }
  }

  $('.mbd-score-list').children('li').each(function(index, el){
    $(el).addClass('show');
  });

  function timeSince(seconds) {
    if(seconds < 60){
      return parseInt(seconds) + '秒';
    }
    if(seconds < 3600){
      return parseInt(seconds/60) + '分钟' + parseInt(seconds%60) + '秒';
    }
    if(seconds <= 86400){
      return parseInt(seconds/3600) + '小时' + parseInt((seconds%3600)/60) + '分';
    }
    if(seconds > 86400){
      var date = new Date(seconds * 1000);
      var day = date.getDate();
      var month = date.toDateString().match(/[a-zA-Z]*/)[0].replace(" ","");
      var year = date.getFullYear() == now.getFullYear() ? "" :  " " + date.getFullYear();
      return day + " " + month + year;
    }
  }

  function newestListCb(data) {
    var result = JSON.parse(data);
    console.log(result);

    var now = Math.floor(Date.now() / 1000);

    var newest = result[result.length - 1];
    var time = timeSince(now - newest.time);

    var li = $('<li />', {class: 'mbd-score-item'});
    var imgDiv = $('<div />', {class: 'mbd-score-avatar'});
    var reslDiv = $('<div />', {class: 'mbd-score-resl'});

    $('<img/>', {
      class: 'mbd-avatar-img',
      alt: newest.uid,
      src: newest.info
    }).appendTo(imgDiv)

    $('<b />', {
      class: 'mbd-score-name',
      text: newest.uid
    }).appendTo(reslDiv)
    $('<span />', {
      class: 'mbd-score-time',
      text: time
    }).appendTo(reslDiv)
    $('<span />', {
      class: 'mbd-score-gift',
      text: newest.gift + ' '
    }).append($('<b />', {
      class: 'status',
      text: newest.ifUsed == 0 ? '未认领' : '已认领'
    })).appendTo(reslDiv)

    li.append(imgDiv).append(reslDiv);

    if ($('.mbd-score-list').children().length > 7) {
      $('.mbd-score-list').children().slice(-1).remove();
    }
    $('.mbd-score-list').prepend(li);
    li.addClass('show');
  }

  var method,
    url = '//mxd.tencent.com/weixin/160818-mbd/server/',
    data,
    type,
    callback;

  // setInterval(function() {
  //   method = 'GET';
  //   url += 'ajax?rank=true&getAll=true&order=time';
  //   type= 'text';
  //   AJAX(method, url, true, type, newestListCb, data);
  // }, 3000);

  // var worker = new Worker('../js/score_task.js');
  // worker.addEventListener('message', function(e){
  // }, false);
  // worker.postMessage('start');
});
</script>
</body>
</html>
